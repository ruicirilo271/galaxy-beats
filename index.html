<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Galaxy Beats ‚Äî Neon Album Player</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ===========================================================
   BACKGROUND NEON ‚Äî PART√çCULAS
=========================================================== */
body {
  margin: 0;
  background: #000013;
  font-family: "Orbitron", sans-serif;
  overflow-x: hidden;
}

#particlesCanvas {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 0;
  background: radial-gradient(circle at 50% 50%, #001, #000015, #000);
}

/* ============================================================== 
   SEARCH BAR NEON
============================================================== */
#searchContainer {
  display: flex;
  justify-content: center;
  margin: 40px;
  position: relative;
  z-index: 2;
}

#searchTerm {
  width: 330px;
  padding: 12px;
  font-size: 18px;
  border: 2px solid #00eaff;
  background: #000;
  color: #00eaff;
  border-radius: 10px 0 0 10px;
}

#searchButton {
  padding: 12px 20px;
  background: #00eaff;
  color: #000;
  font-size: 18px;
  border-radius: 0 10px 10px 0;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

/* ===========================================================
   √ÅLBUNS ‚Äî NEON
=========================================================== */
#albumList {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  z-index: 2;
  position: relative;
}

.album {
  width: 160px;
  margin: 15px;
  border: 2px solid #00eaff;
  border-radius: 12px;
  overflow: hidden;
  background: #001425;
  box-shadow: 0 0 20px #0088cc;
  transition: 0.25s ease;
}

.album:hover {
  transform: scale(1.08);
  box-shadow: 0 0 30px #00eaff;
}

.album img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

.album button {
  width: 100%;
  padding: 12px;
  background: #00eaff;
  color: #001019;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

/* ===========================================================
   TRACKLIST + PLAYER AREA
=========================================================== */
#mediaContainer {
  display: flex;
  justify-content: center;
  gap: 40px;
  margin-top: 40px;
  z-index: 2;
  position: relative;
}

#trackList {
  width: 320px;
  list-style: none;
  padding: 0;
}

#trackList li a {
  display: block;
  padding: 12px;
  margin-bottom: 10px;
  border: 2px solid #00eaff;
  border-radius: 12px;
  background: #00101d;
  color: #00eaff;
  text-decoration: none;
  transition: 0.25s;
}

#trackList li a:hover {
  background: #00eaff;
  color: #000;
}

/* ===========================================================
   PLAYER FLUTUANTE ESTILO SPOTIFY
=========================================================== */
#floatingPlayer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 95px;

  background: rgba(0,0,20,0.92);
  border-top: 2px solid #00eaff;

  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;

  padding: 10px 20px;
  box-sizing: border-box;
  z-index: 9999;
  box-shadow: 0 0 25px #00eaff;
}

#fp-cover {
  width: 70px;
  height: 70px;
  border: 2px solid #00eaff;
  border-radius: 10px;
  background-size: cover;
  background-position: center;
  flex-shrink: 0;
}

#fp-info {
  flex: 1;
  color: #00eaff;
  min-width: 120px;
}

#fp-eq {
  width: 100px;
  height: 45px;
  flex-shrink: 0;
}

#fp-controls {
  flex-shrink: 0;
  display: flex;
  gap: 10px;
}

#fp-controls button {
  padding: 10px 12px;
  border: 2px solid #00eaff;
  background: #000;
  color: #00eaff;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: 0.25s;
}

#fp-controls button:hover {
  background: #00eaff;
  color: #000;
}

/* ===========================================================
   PLAYER YOUTUBE
=========================================================== */
#videoContainer iframe {
  border: 2px solid #00eaff;
  border-radius: 12px;
  box-shadow: 0 0 25px #00eaff;
}
</style>
</head>

<body>

<canvas id="particlesCanvas"></canvas>

<!-- SEARCH BAR -->
<div id="searchContainer">
  <input id="searchTerm" placeholder="Pesquisar √°lbum...">
  <button id="searchButton">üîç</button>
</div>

<!-- √ÅLBUNS -->
<div id="albumList"></div>

<!-- TRACKLIST + PLAYER -->
<div id="mediaContainer">
  <ul id="trackList"></ul>
  <div id="videoContainer"></div>
</div>

<!-- PLAYER FLUTUANTE -->
<div id="floatingPlayer">
  <div id="fp-cover"></div>
  <div id="fp-info">Nenhuma faixa</div>
  <canvas id="fp-eq"></canvas>

  <div id="fp-controls">
    <button onclick="previousTrack()">‚èÆ</button>
    <button onclick="nextTrack()">‚è≠</button>
  </div>
</div>

<script>
/* ===========================================================
   CONFIG VARS
=========================================================== */
const LASTFM_KEY = "6e7c0a29cd508f42a6737e5fd3d6110b";
const YT_KEY = "AIzaSyA4ylzKcNtPrs92-CuS4s-Fx2PFTCeHmro";   // <‚îÄ‚îÄ COLA AQUI A TUA NOVA API KEY
const LASTFM_URL = "https://ws.audioscrobbler.com/2.0/";

let currentTracks = [];
let currentIndex = 0;
let currentCover = null;

/* ===========================================================
   PESQUISA DE √ÅLBUNS
=========================================================== */
document.getElementById("searchButton").onclick = async () => {
  const term = searchTerm.value.trim();
  if (!term) return;

  const url =
    `${LASTFM_URL}?method=album.search&album=${encodeURIComponent(term)}&api_key=${LASTFM_KEY}&limit=7&format=json`;

  const r = await fetch(url);
  const j = await r.json();

  showAlbums(j.results.albummatches.album || []);
};

function showAlbums(albums) {
  albumList.innerHTML = "";

  albums.forEach(a => {
    const img = a.image?.[2]?.['#text'] || "https://i.imgur.com/3ZQ3Z4P.png";

    albumList.innerHTML += `
      <div class="album">
        <img src="${img}">
        <button onclick="loadTracks('${encodeURIComponent(a.artist)}','${encodeURIComponent(a.name)}','${img}')">
          ${a.name}
        </button>
      </div>
    `;
  });
}

/* ===========================================================
   CARREGAR FAIXAS DO √ÅLBUM
=========================================================== */
async function loadTracks(artist, album, cover) {
  currentCover = cover;

  const url =
    `${LASTFM_URL}?method=album.getinfo&artist=${artist}&album=${album}&api_key=${LASTFM_KEY}&format=json`;

  const r = await fetch(url);
  const j = await r.json();

  currentTracks = j.album.tracks.track || [];
  currentIndex = 0;

  showTracks();
  playTrack(0);
}

function showTracks() {
  trackList.innerHTML = "";
  currentTracks.forEach((t, i) => {
    trackList.innerHTML += `
      <li><a href="#" onclick="playTrack(${i});return false;">${t.name}</a></li>
    `;
  });
}

/* ===========================================================
   YOUTUBE PLAYER + FALLBACK ANTI 153
=========================================================== */
function playTrack(index) {
  currentIndex = index;

  const name = currentTracks[index].name;
  document.getElementById("fp-info").innerText = name;
  document.getElementById("fp-cover").style.backgroundImage = `url(${currentCover})`;

  bumpEQ();

  const url =
    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${
      encodeURIComponent(name)
    }&type=video&maxResults=5&key=${YT_KEY}`;

  fetch(url)
    .then(r => r.json())
    .then(d => tryEmbedVideosSequentially(d.items, 0));
}

/* tenta v√≠deo por v√≠deo */
function tryEmbedVideosSequentially(videos, i) {
  if (i >= videos.length) {
    videoContainer.innerHTML =
      "<p style='color:#00eaff'>‚ùå Nenhum v√≠deo permite embed.</p>";
    return;
  }

  const id = videos[i].id.videoId;

  videoContainer.innerHTML = `
    <iframe id="ytplayer" width="560" height="315"
    src="https://www.youtube.com/embed/${id}?autoplay=1&enablejsapi=1"
    frameborder="0" allow="autoplay" allowfullscreen></iframe>
  `;

  setTimeout(() => {
    const iframe = document.getElementById("ytplayer");

    if (!iframe || iframe.contentWindow.length === 0) {
      tryEmbedVideosSequentially(videos, i + 1);
    } else {
      setupYTEvents();
    }
  }, 1500);
}

function setupYTEvents() {
  const iframe = document.getElementById("ytplayer");
  if (!iframe) return;

  window.addEventListener("message", e => {
    if (typeof e.data !== "string") return;
    if (!e.data.includes("onStateChange")) return;

    const state = JSON.parse(e.data.replace("onStateChange", ""));
    if (state === 0) nextTrack();
  });

  iframe.contentWindow.postMessage(JSON.stringify({
    event: "command",
    func: "addEventListener",
    args: ["onStateChange"]
  }), "*");
}

function nextTrack() {
  currentIndex++;
  if (currentIndex < currentTracks.length) playTrack(currentIndex);
}

function previousTrack() {
  currentIndex--;
  if (currentIndex < 0) currentIndex = 0;
  playTrack(currentIndex);
}

/* ===========================================================
   PARTICULAS NEON
=========================================================== */
const canvas = particlesCanvas;
const ctxP = canvas.getContext("2d");
let W, H, particles;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.onresize = resize;

function createParticles() {
  particles = [];
  for (let i = 0; i < 80; i++) {
    particles.push({
      x: Math.random() * W,
      y: Math.random() * H,
      s: Math.random() * 4 + 1,
      v: Math.random() * 0.5 + 0.2
    });
  }
}
createParticles();

function animateParticles() {
  ctxP.clearRect(0, 0, W, H);

  particles.forEach(p => {
    p.y += p.v;
    if (p.y > H) p.y = -10;

    ctxP.fillStyle = "rgba(0,200,255,0.8)";
    ctxP.beginPath();
    ctxP.arc(p.x, p.y, p.s, 0, Math.PI * 2);
    ctxP.fill();
  });

  requestAnimationFrame(animateParticles);
}
animateParticles();

/* ===========================================================
   EQUALIZADOR NEON
=========================================================== */
const eqCanvas = document.getElementById("fp-eq");
const eqCtx = eqCanvas.getContext("2d");
eqCanvas.width = 100;
eqCanvas.height = 45;

function bumpEQ() {
  function draw() {
    eqCtx.clearRect(0, 0, eqCanvas.width, eqCanvas.height);

    for (let i = 0; i < 8; i++) {
      let h = Math.random() * 45;
      eqCtx.fillStyle = "#00eaff";
      eqCtx.fillRect(i * 12, 45 - h, 10, h);
    }

    requestAnimationFrame(draw);
  }
  draw();
}
</script>

</body>
</html>
